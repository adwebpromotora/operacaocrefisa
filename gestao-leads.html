<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Leads Crefisa</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .cards { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .card { background: #f0f0f0; padding: 15px; border-radius: 5px; text-align: center; width: 20%; }
        .search { margin-bottom: 20px; }
        #searchInput { width: 100%; padding: 10px; box-sizing: border-box; }
        .form { margin-bottom: 20px; background: #fff; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .form input, .form select, .form textarea { width: 100%; margin-bottom: 10px; padding: 8px; box-sizing: border-box; }
        .form button { padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        .leads-list { list-style: none; padding: 0; }
        .lead-item { background: #fff; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; }
        .lead-item:hover { background: #f9f9f9; }
        .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background: rgba(0,0,0,0.4); }
        .modal-content { background: #fff; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .history { margin-top: 20px; }
        .comment { border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px; }
        #addCommentBtn { margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sistema de Gestão de Leads Crefisa</h1>
        
        <!-- Cards com Indicadores -->
        <div class="cards">
            <div class="card">
                <h3>Leads Cadastrados</h3>
                <p id="totalLeads">0</p>
            </div>
            <div class="card">
                <h3>Valor Total - Fazer Contato</h3>
                <p id="valorFazerContato">R$ 0</p>
            </div>
            <div class="card">
                <h3>Valor Total - Erro</h3>
                <p id="valorErro">R$ 0</p>
            </div>
            <div class="card">
                <h3>Valor Total - Simulado</h3>
                <p id="valorSimulado">R$ 0</p>
            </div>
            <div class="card">
                <h3>Valor Total - Sem Interesse</h3>
                <p id="valorSemInteresse">R$ 0</p>
            </div>
            <div class="card">
                <h3>Valor Total - Em Negociação</h3>
                <p id="valorEmNegociacao">R$ 0</p>
            </div>
            <div class="card">
                <h3>Valor Total - Vendido</h3>
                <p id="valorVendido">R$ 0</p>
            </div>
        </div>
        
        <!-- Busca Inteligente -->
        <div class="search">
            <input type="text" id="searchInput" placeholder="Busque por nome, CPF, telefone, WhatsApp, email ou anotações...">
        </div>
        
        <!-- Formulário de Adição de Lead -->
        <div class="form">
            <h2>Adicionar Novo Lead</h2>
            <input type="text" id="nome" placeholder="Nome Completo" required>
            <input type="text" id="cpf" placeholder="CPF" required>
            <input type="text" id="telefone" placeholder="Telefone">
            <input type="text" id="whatsapp" placeholder="WhatsApp">
            <input type="email" id="email" placeholder="Email">
            <input type="number" id="valorLiberado" placeholder="Valor Liberado" step="0.01" required>
            <textarea id="anotacao" placeholder="Anotação"></textarea>
            <select id="status" required>
                <option value="">Selecione Status</option>
                <option value="fazer contato">Fazer Contato</option>
                <option value="erro">Erro</option>
                <option value="simulado">Simulado</option>
                <option value="sem interesse">Sem Interesse</option>
                <option value="em negociação">Em Negociação</option>
                <option value="vendido">Vendido</option>
            </select>
            <button onclick="addLead()">Adicionar Lead</button>
        </div>
        
        <!-- Lista de Leads -->
        <ul id="leadsList" class="leads-list"></ul>
    </div>
    
    <!-- Modal de Detalhes do Lead -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Detalhes do Lead</h2>
            <form id="editForm">
                <input type="hidden" id="editId">
                <input type="text" id="editNome" placeholder="Nome Completo" required>
                <input type="text" id="editCpf" placeholder="CPF" required>
                <input type="text" id="editTelefone" placeholder="Telefone">
                <input type="text" id="editWhatsapp" placeholder="WhatsApp">
                <input type="email" id="editEmail" placeholder="Email">
                <input type="number" id="editValorLiberado" placeholder="Valor Liberado" step="0.01" required>
                <textarea id="editAnotacao" placeholder="Anotação"></textarea>
                <select id="editStatus" required>
                    <option value="fazer contato">Fazer Contato</option>
                    <option value="erro">Erro</option>
                    <option value="simulado">Simulado</option>
                    <option value="sem interesse">Sem Interesse</option>
                    <option value="em negociação">Em Negociação</option>
                    <option value="vendido">Vendido</option>
                </select>
                <button type="button" onclick="saveEdit()">Salvar Alterações</button>
            </form>
            <div class="history">
                <h3>Histórico de Comentários</h3>
                <div id="commentsList"></div>
                <textarea id="newComment" placeholder="Adicionar novo comentário"></textarea>
                <button id="addCommentBtn" onclick="addComment()">Adicionar Comentário</button>
            </div>
        </div>
    </div>

    <script>
        let leads = JSON.parse(localStorage.getItem('leads')) || [];
        let currentLeadId = null;

        function formatCurrency(value) {
            return `R$ ${parseFloat(value).toFixed(2).replace('.', ',').replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.')}`;
        }

        function updateIndicators() {
            const totalLeads = leads.length;
            document.getElementById('totalLeads').textContent = totalLeads;

            const statuses = ['fazer contato', 'erro', 'simulado', 'sem interesse', 'em negociação', 'vendido'];
            statuses.forEach(status => {
                const filtered = leads.filter(lead => lead.status === status);
                const totalValor = filtered.reduce((sum, lead) => sum + (parseFloat(lead.valorLiberado) || 0), 0);
                const id = `valor${status.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join('').replace(/ç/g, 'c').replace(/ã/g, 'a')}`;
                document.getElementById(id).textContent = formatCurrency(totalValor);
            });
        }

        function renderLeads(searchTerm = '') {
            const list = document.getElementById('leadsList');
            list.innerHTML = '';
            const filteredLeads = leads.filter(lead => {
                const searchLower = searchTerm.toLowerCase();
                return (
                    lead.nome.toLowerCase().includes(searchLower) ||
                    lead.cpf.includes(searchLower) ||
                    lead.telefone.includes(searchLower) ||
                    lead.whatsapp.includes(searchLower) ||
                    lead.email.toLowerCase().includes(searchLower) ||
                    lead.anotacao.toLowerCase().includes(searchLower)
                );
            });
            filteredLeads.forEach(lead => {
                const item = document.createElement('li');
                item.className = 'lead-item';
                item.textContent = `${lead.nome} - CPF: ${lead.cpf} - Status: ${lead.status}`;
                item.onclick = () => openModal(lead.id);
                list.appendChild(item);
            });
        }

        function addLead() {
            const newLead = {
                id: Date.now(),
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                telefone: document.getElementById('telefone').value,
                whatsapp: document.getElementById('whatsapp').value,
                email: document.getElementById('email').value,
                valorLiberado: document.getElementById('valorLiberado').value,
                anotacao: document.getElementById('anotacao').value,
                status: document.getElementById('status').value,
                comments: []
            };
            leads.push(newLead);
            saveLeads();
            clearAddForm();
            renderLeads();
            updateIndicators();
        }

        function clearAddForm() {
            document.getElementById('nome').value = '';
            document.getElementById('cpf').value = '';
            document.getElementById('telefone').value = '';
            document.getElementById('whatsapp').value = '';
            document.getElementById('email').value = '';
            document.getElementById('valorLiberado').value = '';
            document.getElementById('anotacao').value = '';
            document.getElementById('status').value = '';
        }

        function openModal(id) {
            currentLeadId = id;
            const lead = leads.find(l => l.id === id);
            document.getElementById('editId').value = lead.id;
            document.getElementById('editNome').value = lead.nome;
            document.getElementById('editCpf').value = lead.cpf;
            document.getElementById('editTelefone').value = lead.telefone;
            document.getElementById('editWhatsapp').value = lead.whatsapp;
            document.getElementById('editEmail').value = lead.email;
            document.getElementById('editValorLiberado').value = lead.valorLiberado;
            document.getElementById('editAnotacao').value = lead.anotacao;
            document.getElementById('editStatus').value = lead.status;
            renderComments(lead.comments);
            document.getElementById('leadModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('leadModal').style.display = 'none';
            currentLeadId = null;
        }

        function saveEdit() {
            const id = parseInt(document.getElementById('editId').value);
            const leadIndex = leads.findIndex(l => l.id === id);
            leads[leadIndex] = {
                ...leads[leadIndex],
                nome: document.getElementById('editNome').value,
                cpf: document.getElementById('editCpf').value,
                telefone: document.getElementById('editTelefone').value,
                whatsapp: document.getElementById('editWhatsapp').value,
                email: document.getElementById('editEmail').value,
                valorLiberado: document.getElementById('editValorLiberado').value,
                anotacao: document.getElementById('editAnotacao').value,
                status: document.getElementById('editStatus').value
            };
            saveLeads();
            closeModal();
            renderLeads(document.getElementById('searchInput').value);
            updateIndicators();
        }

        function addComment() {
            const comment = document.getElementById('newComment').value;
            if (comment) {
                const lead = leads.find(l => l.id === currentLeadId);
                lead.comments.push({ text: comment, date: new Date().toLocaleString('pt-BR') });
                saveLeads();
                renderComments(lead.comments);
                document.getElementById('newComment').value = '';
            }
        }

        function renderComments(comments) {
            const list = document.getElementById('commentsList');
            list.innerHTML = '';
            comments.forEach(comment => {
                const div = document.createElement('div');
                div.className = 'comment';
                div.textContent = `${comment.date}: ${comment.text}`;
                list.appendChild(div);
            });
        }

        function saveLeads() {
            localStorage.setItem('leads', JSON.stringify(leads));
        }

        // Evento de Busca
        document.getElementById('searchInput').addEventListener('input', (e) => {
            renderLeads(e.target.value);
        });

        // Inicialização
        renderLeads();
        updateIndicators();

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('leadModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
